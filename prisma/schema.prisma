generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Token {
  id                     String   @id @default(cuid())
  mintAddress            String   @unique @map("mint_address")
  symbol                 String
  name                   String
  imageUri               String?  @map("image_uri")
  metadataUri            String?  @map("metadata_uri")
  twitter                String?
  telegram               String?
  website                String?
  description            String?
  creatorAddress         String   @map("creator_address")
  createdTimestamp       BigInt   @map("created_timestamp")
  kingOfTheHillTimestamp BigInt?  @map("king_of_the_hill_timestamp")
  completed              Boolean  @default(false) @map("completed")
  bondingCurve           String?  @map("bonding_curve")
  associatedBondingCurve String?  @map("associated_bonding_curve")
  updatedAt              DateTime @default(now()) @updatedAt @map("updated_at")

  price      TokenPrice?
  trades     Trade[]
  candles1m  PumpCandle1m[]
  features1m PumpFeature1m[]

  @@index([completed, kingOfTheHillTimestamp])
  @@index([createdTimestamp])
  @@map("tokens")
}

model TokenPrice {
  tokenId            String   @id @map("token_id")
  priceSol           Decimal  @map("price_sol")
  priceUsd           Decimal  @map("price_usd")
  marketCapUsd       Decimal  @map("market_cap_usd")
  lastTradeTimestamp BigInt   @map("last_trade_timestamp")
  updatedAt          DateTime @default(now()) @updatedAt @map("updated_at")
  token              Token    @relation(fields: [tokenId], references: [id], onDelete: Cascade)

  @@map("token_prices")
}

model Trade {
  id          Int      @id @default(autoincrement())
  tokenId     String   @map("token_id")
  txSignature String   @unique @map("tx_signature")
  userAddress String   @map("user_address")
  isBuy       Boolean  @map("is_buy")
  amountSol   Decimal  @map("amount_sol")
  amountUsd   Decimal  @map("amount_usd")
  baseAmount  Decimal  @map("base_amount")
  priceSol    Decimal  @map("price_sol")
  priceUsd    Decimal  @map("price_usd")
  timestamp   BigInt
  createdAt   DateTime @default(now()) @map("created_at")
  raw         Json?
  token       Token    @relation(fields: [tokenId], references: [id], onDelete: Cascade)

  @@index([tokenId, timestamp])
  @@index([timestamp])
  @@map("trades")
}

model PumpCandle1m {
  id        Int      @id @default(autoincrement())
  tokenId   String   @map("token_id")
  timestamp DateTime
  open      Decimal  @db.Decimal(20, 8)
  high      Decimal  @db.Decimal(20, 8)
  low       Decimal  @db.Decimal(20, 8)
  close     Decimal  @db.Decimal(20, 8)
  volumeUsd Decimal  @map("volume_usd") @db.Decimal(24, 8)
  volumeSol Decimal  @map("volume_sol") @db.Decimal(24, 8)
  trades    Int
  createdAt DateTime @default(now()) @map("created_at")
  token     Token    @relation(fields: [tokenId], references: [id], onDelete: Cascade)

  @@unique([tokenId, timestamp])
  @@index([tokenId, timestamp])
  @@index([timestamp])
  @@map("pump_candles_1m")
}

model PumpFeature1m {
  id         Int      @id @default(autoincrement())
  tokenId    String   @map("token_id")
  timestamp  DateTime
  return     Decimal? @map("return") @db.Decimal(20, 8)
  range      Decimal? @db.Decimal(20, 8)
  body       Decimal? @db.Decimal(20, 8)
  dlogVolume Decimal? @map("dlog_volume") @db.Decimal(20, 8)
  retMean15  Decimal? @map("ret_mean_15") @db.Decimal(20, 8)
  retStd15   Decimal? @map("ret_std_15") @db.Decimal(20, 8)
  retMean60  Decimal? @map("ret_mean_60") @db.Decimal(20, 8)
  retStd60   Decimal? @map("ret_std_60") @db.Decimal(20, 8)
  createdAt  DateTime @default(now()) @map("created_at")
  token      Token    @relation(fields: [tokenId], references: [id], onDelete: Cascade)

  @@unique([tokenId, timestamp])
  @@index([tokenId, timestamp])
  @@index([timestamp])
  @@map("pump_features_1m")
}

model PumpSolPrice {
  id            Int      @id @default(autoincrement())
  hourTimestamp BigInt   @unique @map("hour_timestamp")
  priceUsd      Decimal  @map("price_usd") @db.Decimal(20, 8)
  createdAt     DateTime @default(now()) @map("created_at")

  @@index([hourTimestamp])
  @@map("pump_sol_prices")
}
